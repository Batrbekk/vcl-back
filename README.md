# VCL Backend API

–ë—ç–∫–µ–Ω–¥ API –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ VCL, —Ö–æ—Å—Ç–∏–Ω–≥ –Ω–∞ Vercel.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend:** Node.js, TypeScript, Express.js
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** MongoDB (Mongoose)
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** JWT, bcryptjs
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** Swagger
- **Email:** Nodemailer
- **–•–æ—Å—Ç–∏–Ω–≥:** Vercel

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js (–≤–µ—Ä—Å–∏—è 14 –∏–ª–∏ –≤—ã—à–µ)
- MongoDB
- npm –∏–ª–∏ yarn

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/your-username/vcl-back.git
cd vcl-back
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
PORT=3000
NODE_ENV=development # –∏–ª–∏ production –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
MONGODB_URI=your_mongodb_uri

# JWT
JWT_SECRET=your_jwt_secret

# Email
EMAIL_USER=your_email
EMAIL_PASS=your_email_password
```

## üöÄ –ó–∞–ø—É—Å–∫

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
npm run dev
```

### –ü—Ä–æ–¥–∞–∫—à–Ω
```bash
npm run build
npm start
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É `/api-docs` –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Swagger UI –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

## üåê –•–æ—Å—Ç–∏–Ω–≥

–ü—Ä–æ–µ–∫—Ç —Ö–æ—Å—Ç–∏—Ç—Å—è –Ω–∞ Vercel. –î–ª—è –¥–µ–ø–ª–æ—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π CI/CD —á–µ—Ä–µ–∑ GitHub.

### –î–µ–ø–ª–æ–π –Ω–∞ Vercel

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ Vercel
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤–∞—à GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel:
   - NODE_ENV=production
   - MONGODB_URI
   - JWT_SECRET
   - EMAIL_USER
   - EMAIL_PASS

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
vcl-back/
‚îú‚îÄ‚îÄ src/            # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îú‚îÄ‚îÄ public/         # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ views/          # –®–∞–±–ª–æ–Ω—ã
‚îú‚îÄ‚îÄ .vscode/        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ VS Code
‚îú‚îÄ‚îÄ .gitignore      # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã Git
‚îú‚îÄ‚îÄ package.json    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ tsconfig.json   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript
‚îú‚îÄ‚îÄ vcl-api.yaml    # Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ vercel.json     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vercel
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å –ø–æ–º–æ—â—å—é bcrypt
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ .env

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

ISC

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ LLM –º–æ–¥–µ–ª—è—Ö –∏ —Ü–µ–Ω–∞—Ö

–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö LLM –º–æ–¥–µ–ª–µ–π –∏ –∏—Ö —Ü–µ–Ω –∑–∞ –º–∏–Ω—É—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

**GET** `/api/agents/llm-prices`

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
- `agent_id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - ID –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X GET "http://localhost:3000/api/agents/llm-prices" \
     -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "message": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö LLM –º–æ–¥–µ–ª—è—Ö –ø–æ–ª—É—á–µ–Ω–∞",
  "llm_prices": [
    {
      "llm": "gpt-4o-mini",
      "price_per_minute": 0.0006269457946554367
    },
    {
      "llm": "gpt-4o",
      "price_per_minute": 0.010449096577590612
    },
    {
      "llm": "claude-3-5-sonnet",
      "price_per_minute": 0.012956660467721747
    }
  ],
  "retrieved_at": "2025-01-15T12:00:00Z"
}
```

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: Bearer Token (JWT)
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger:
–≠–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ Swagger UI –ø–æ –∞–¥—Ä–µ—Å—É `/api-docs`

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏–∑ ElevenLabs:

**GET** `/api/agents/knowledge-base`

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
- `cursor` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫—É—Ä—Å–æ—Ä –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- `page_size` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X GET "http://localhost:3000/api/agents/knowledge-base?page_size=10" \
     -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "message": "–°–ø–∏—Å–æ–∫ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –ø–æ–ª—É—á–µ–Ω",
  "documents": [
    {
      "id": "POWdTREbVATbWkxwau6A",
      "name": "Mycar.kz - –ü–æ–∫—É–ø–∫–∞ –∏ –ø—Ä–æ–¥–∞–∂–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ",
      "metadata": {
        "created_at_unix_secs": 1750195117,
        "last_updated_at_unix_secs": 1750195117,
        "size_bytes": 3051
      },
      "supported_usages": ["prompt", "auto"],
      "access_info": {
        "is_creator": true,
        "creator_name": "Batyrbek Kuandyk",
        "creator_email": "batrbekk@gmail.com",
        "role": "admin"
      },
      "dependent_agents": [],
      "type": "url",
      "url": "https://mycar.kz"
    }
  ],
  "next_cursor": null,
  "has_more": false,
  "retrieved_at": "2025-01-15T12:00:00Z"
}
```

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: Bearer Token (JWT)
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger:
–≠–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ Swagger UI –ø–æ –∞–¥—Ä–µ—Å—É `/api-docs`

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–∞ –≤ ElevenLabs —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –≤ MongoDB:

**PATCH** `/api/agents/{id}`

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - ID –∞–≥–µ–Ω—Ç–∞ –≤ ElevenLabs

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (–≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã):
- `name` - –∏–º—è –∞–≥–µ–Ω—Ç–∞
- `conversation_config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞
- `platform_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- `tags` - –º–∞—Å—Å–∏–≤ —Ç–µ–≥–æ–≤

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X PATCH "http://localhost:3000/api/agents/yufIbo0uUuoT5yZv5vds" \
     -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"name": "Guzel", "tags": ["sales", "mycar"]}'
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "message": "–ê–≥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω",
  "agent_id": "yufIbo0uUuoT5yZv5vds",
  "name": "Guzel",
  "conversation_config": {
    "asr": {
      "quality": "high",
      "provider": "elevenlabs"
    }
  },
  "tags": ["sales", "mycar"],
  "synced": true,
  "synced_at": "2025-01-15T12:00:00Z",
  "updated_at": "2025-01-15T12:00:00Z"
}
```

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: Bearer Token (JWT)
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- –ê–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å MongoDB –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è)

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger:
–≠–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ Swagger UI –ø–æ –∞–¥—Ä–µ—Å—É `/api-docs`